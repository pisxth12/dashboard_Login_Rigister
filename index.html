<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="./assets/style.css">
  <link rel="stylesheet" href="./assets/chart.css">
  <link rel="stylesheet" href="./assets/icon.css">
  <link rel="stylesheet" href="./assets/darkmode.css">
  <link rel="stylesheet" href="./assets/addProduct.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
  <div class="container-fluids d-flex">
      <div class="dashboard_menu d-lg-block d-none rounded-3 ">
       <div class="title d-flex justify-content-center p-2">
         <h3>Sorn Piseth</h3>
       </div>


        <div class="dashboard_buttons mt-3 d-flex flex-column gap-3 p-4">
            <button class="btn  btn-nav" data-content="home">Home</button>
            <button class="btn  btn-nav" data-content="product">Product</button>
            <button class="btn  btn-nav" data-content="dashboard">Dashboard</button>
            <button class="btn  btn-nav" data-content="add_product">Add Product</button>
        </div>


      </div>

      <div class="dashboard_content ">
        <nav class="navBar_dashboard shadow-lg rounded-3">

          <div class="title d-flex align-items-center">
            <h3 class="fw-bold">Dashboard</h3>
          </div>
          

          

          <div class="user_content">
            <div class="bell "><i class="fa-solid fa-bell"></i></div>
            <div class="mail"><i class="fa-solid fa-envelope"></i></div>
                
            
            <div class="dark_mode">
                      <div class="moon">
                        <i class="fa-solid fa-moon"></i>
                      </div>
             </div>


            <div class="user_account">
              
              <!-- login form -->
 
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">
                      Login
                    </button>
                    <!-- Login Modal -->
                    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form id="loginForm" method="post" enctype="multipart/form-data" autocomplete="on">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="loginModalLabel">Login</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  <div class="mb-3">
                                      <label for="emailLogin" class="form-label">Email</label>
                                      <input type="email" class="form-control" id="emailLogin" name="email" required autocomplete="email">
                                  </div>
                                  <div class="mb-3">
                                      <label for="passwordLogin" class="form-label">Password</label>
                                      <input type="password" class="form-control" id="passwordLogin" name="password" required autocomplete="current-password">
                                  </div>
                              </div>
                              <div class="modal-footer">
                                  <button type="submit" class="btn btn-primary">Login</button>
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              </div>
                          </form>

                        </div>
                      </div>
                    </div>



               
               
              


                  <!-- register -->
              <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Register
              </button>
                  <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">


                        <form action="" id="registerForm" method="post" enctype="multipart/form-data">
                              <!-- Username -->
                              <div class="mb-1">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" required>
                              </div>

                              <!-- Email -->
                              <div class="mb-1">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                              </div>

                              <!-- Password -->
                              <div class="mb-1">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                              </div>

                              <!-- Confirm Password -->
                              <div class="mb-1">
                                <label for="confirm" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="confirm" name="confirm" required>
                              </div>

                              <!-- Image Upload -->
                              <div class="mb-1">
                                <label for="image" class="form-label">Upload Image</label>
                                <input type="file" class="form-control" id="registerImage" name="image" accept="image/*">
                              </div>

                              <!-- Submit -->
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Register now</button>
                              </div>
                            </form>
                      </div>
                      
                    </div>
                  </div>
                </div>


            </div>
          </div>
        </nav>

        <div class="content_info  overflow-y-auto ">

            <div id="main_content" class="p-3 mt-3">
                  <div class="title">

                         <div class="left d-flex gap-2 align-items-center">
                   <div class="bag">
                      <i class="fa-solid fa-bag-shopping"></i>
                    </div>

                    <div class="title-content d-flex flex-column  ">
                      <h5 class="bg-secondary">Wellcome to website</h5>
                      <p class="bg-danger">Lorem ipsum dolor sit amet consectetur.</p>
                    </div>

                  </div>
                  <div class="right">


                  </div>
                </div>


              </div>





                <div id="dashboard_template" class="d-none" style="display: none;">
                    <div class="title-content d-flex justify-content-between">
                      <div class="title">
                        <h4>Dashboad</h4>
                      </div>
                     
                    </div>
                    <div class="notification ">
                      <p>Lorem ipsum dolor sit.</p>
                    </div>

                    <div class="contetn_chart">
                      <div class="small-content ">
                      
                        <div class="box-content bg-black">
                              <h1>Hello</h1>
                        </div>
                      
                        <div class="box-content bg-warning">
                              <h1>Hello</h1>
                        </div>
                      
                        <div class="box-content bg-secondary">
                              <h1>Hello</h1>
                        </div>
                      
                        <div class="box-content bg-primary">
                              <h1>Hello</h1>
                        </div>
                      </div>
                      <div class="big-content ">

                        <div class="line-charts">
                          <canvas id="myChart"></canvas>
                        </div>
                        <div class="round-charts">
                          <canvas id="myDoughnutChart"></canvas>
                        </div>
                        
                      </div>
                    </div>

                  </div>

                  <div id="home_template" class="d-none" >
                    <h3>Lorem ipsum dolor sit amet.</h3>
                  </div>
              
                  <div id="product_template" class="d-none">
                      <div class="title mt-2 d-flex justify-content-between align-items-center">
                        <div class="title-content">
                          <h1 class="fw-bold fs-1">Product</h1>
                        </div>

                        <div class="select-option">
                          <select id="genderFilter" class="rounded-1 p-1 border-2 border-secondary">
                            <option value="">Select Type</option>
                            <option value="hypercar">Hypercar</option>
                            <option value="supercar">Supercarr</option>
                          </select>
                        </div>
                      </div>

                      <div class="product-content shadow-lg p-3">
                        <div id="productList" class="row g-3">

                        </div>
                      </div>
                      <script src="./api/js//fetchProduct.js"></script>
                     
                    </div>

                  <div id="add_product" class="d-none " >

                            
                      <div class="title_add_product d-flex justify-content-between align-items-center">
                        <div class="left">
                          <h5 style="text-transform: uppercase; font-weight: bold;">Add Product</h5>
                        </div>

                        <div class="add_product_content" id="ddd">
                          <button type="button" class="btn btn-primary btn-modal1" data-bs-toggle="modal" data-bs-target="#modal1">
                            Add Product
                          </button>

                          <div class="modal fade" id="modal1" tabindex="-1" aria-labelledby="modal1Label" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="modal1Label">Add Product</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">


                                  <form id="addProductForm" enctype="multipart/form-data">
                                    <div class="product_add_content mb-3">
                                      <label for="productName" class="form-label" >Product Name</label>
                                      <input type="text" id="productName" name="productName" class="form-control" required autocomplete="off">
                                    </div>

                                    <div class="product_add_content mb-3">
                                      <label for="price" class="form-label">Price</label>
                                      <input type="number" id="price" name="price" class="form-control" step="0.01" required autocomplete="off">
                                    </div>

                                    <div class="product_add_content mb-3">
                                      <label for="productImage" class="form-label">Product Image</label>
                                      <input type="file" id="productImage" name="productImage" class="form-control" accept="image/*">
                                    </div>

                                    <div class="product_add_content mb-3">
                                      <label for="description" class="form-label">Description</label>
                                      <textarea id="description" name="description" class="form-control" rows="3"></textarea>
                                    </div>

                                    <div id="response" class="mb-2 text-success"></div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                      <button type="submit" class="btn btn-primary">Save Product</button>
                                    </div>
                                  </form>

                              </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="show-product mt-4 shadow-lg ">
                              <div id="product-display" class="p-4 overflow-y-scroll d-flex  flex-wrap gap-1 m-2 "   >
                              <!-- result add product here-->
                              </div>
                      </div>

                      <script>
                        $(document).ready(function(){

  // Load all products
  function loadProducts(){
    $.ajax({
      url: "http://localhost/dashboards/api/products/fetch_product.php",
      type: "GET",
      dataType: "JSON",
      success: function(products){
        let showHTML = "";
        if(products.length){
          products.forEach(product=>{
            showHTML += `
            <div class="card" style="width: 18rem;">
              <img class="card-img-top object-fit-cover" src="${product.image_url}" alt="${product.productName}" style="height:200px;">
              <div class="card-body">
                <div class="info d-flex justify-content-between py-2">
                  <h5 class="card-title">${product.productName}</h5>
                  <h5>$${parseFloat(product.price).toFixed(2)}</h5>
                </div>
                <p class="card-text">${product.description}</p>
                <button class="remove_product_btn btn btn-danger" data-product="${product.productName}">Remove</button>
              </div>
            </div>`;
          });
        } else {
          showHTML = `<p>No products found.</p>`;
        }
        $("#product-display").html(showHTML);
      },
      error: function(xhr){
        console.log(xhr.responseText);
      }
    });
  }

  loadProducts(); // initial load

  // Add Product Form Submit
  $("#addProductForm").on('submit', function(e){
    e.preventDefault();
    var formData = new FormData(this);

    $.ajax({
      url: "http://localhost/dashboards/api/admin/add_product.php",
      type: "POST",
      data: formData,
      contentType: false,
      processData: false,
      dataType: "JSON",
      success: function(response){
        if(response.status === "success"){
          alert(response.message);
          $("#addProductForm")[0].reset();
          var productModal = bootstrap.Modal.getInstance(document.getElementById('modal1'));
          productModal.hide();
          loadProducts();
        } else {
          alert("Failed: " + response.message);
        }
      },
      error: function(xhr){
        console.log(xhr.responseText);
        alert("Error uploading data");
      }
    });
  });

  // Remove Product
 $(document).off('click', '.remove_product_btn').on('click', '.remove_product_btn', function(){
    let productName = $(this).data('product');
    let card = $(this).closest('.card');

    if(confirm(`Are you sure you want to remove ${productName}?`)){
        $.ajax({
            url: "http://localhost/dashboards/api/admin/delete_product.php",
            type: "POST",
            data: { productName: productName },
            dataType: "JSON",
            success: function(response){
                if(response.status === "success"){
                    alert(response.message);
                    card.remove();
                
                     loadProducts(); 
                } else {
                    alert("Error: " + response.message);
                }
            },
            error: function(xhr){
                console.log(xhr.responseText);
            }
        });
    }
});


});

                      </script>

                      <!-- <script>
                          $(document).ready(function(){


                            function loadProducts(){
                              $.ajax({
                                url:"http://localhost/dashboards/api/products/fetch_product.php",
                                type: "GET",
                                dataType:"JSON",
                                success: function(products){
                                  showHTML = ""
                                  if(products.length){
                                    products.forEach(product=>{
                                      showHTML += `
                                        <div class="card " style="width: 18rem;" >
                                            <img class="card-img-top object-fit-cover" src="${product.image_url}" alt="${product.productName}" >
                                            <div class="card-body">
                                              <div class="info d-flex justify-content-between py-3">
                                                <h5 class="card-title">${product.productName}</h5>
                                                <h5>$${parseFloat(product.price).toFixed(2)}</h5>
                                              </div>
                                              <p class="card-text">${product.description}</p>
                                              <button id="remove_product_btn" class="remove_product_btn btn btn-danger" data-product="${product.productName}">Remove</button>
                                            </div>
                                          </div>
                                      `
                                    })
                                  }else{
                                    showHTML = `<p>No products found.</p>`;
                                  }
                                  $("#product-display").html(showHTML)
                                },
                                error: function(xhr){
                                  console.log(xhr.responseText);
                                }
                              });
                            }

                            loadProducts()




                            $("#addProductForm").on('submit' , function(e){
                              e.preventDefault();
                              var formData = new FormData(this);

                              $.ajax({
                                url:"http://localhost/dashboards/api/admin/add_product.php",
                                type: "POST",
                                data: formData,
                                contentType:false,
                                processData:false,
                                dataType:"JSON",
                                success: function(response){
                                  if(response.status ==="success"){
                                    alert(response.message);
                                    $("#addProductForm")[0].reset();
                                    var productModal = bootstrap.Modal.getInstance(document.getElementById('modal1'));
                                    productModal.hide();
                                    loadProducts()


                                  }else{
                                    alert("Faild" + response.message);
                                  }
                                },
                                error: function(xhr){
                                  console.log(xhr.responseText);
                                  alert("Error Uploding data");
                                }
                              })

                            })

                            




                             $(document).on('click', '#remove_product_btn', function(){
        let productName = $(this).data('product');
        let card = $(this).closest('.card');

        if(confirm(`Are you sure you want to remove ${productName}?`)){
            $.ajax({
                url: "http://localhost/dashboards/api/admin/delete_product.php",
                type: "POST",
                data: { productName: productName },
                success: function(response){
                    if(response.status === "success"){
                        alert(response.message);
                        card.remove();
                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function(xhr){
                    console.log(xhr.responseText);
                }
            });
        }
    });

                            });

                        </script>
                         -->
              </div>

              </div>      
        </div> 
      </div>
  </div>

</body>
<script src="./api/js/darkmode.js"></script>
<script src="./api/js/chart.js"></script>
<script src="./api/js/userLogin.js"></script>
<script src="./api/js/add_products.js"></script>
<script src="./api//js/admin_user_option.js"></script>
<script></script>


</html>
